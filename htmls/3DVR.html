<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Editor 3D VR</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    #ui {
      position: fixed; top: 10px; left: 10px;
      background: rgba(0,0,0,0.9); padding: 12px; border-radius: 10px;
      color: #fff; width: 240px; max-height: 95vh; overflow-y: auto;
      font-family: system-ui; font-size: 11px; z-index: 9999;
    }
    h2 { font-size: 14px; color: #0ff; text-align: center; margin-bottom: 8px; }
    h3 { font-size: 11px; color: #f0f; margin: 10px 0 5px; border-top: 1px solid #333; padding-top: 8px; }
    label { display: block; font-size: 10px; margin: 4px 0 2px; color: #aaa; }
    input[type="range"] { width: 100%; }
    input[type="color"] { width: 30px; height: 20px; border: none; }
    select, button { width: 100%; padding: 5px; margin: 2px 0; border: 1px solid #444; border-radius: 4px; background: #222; color: #fff; font-size: 10px; cursor: pointer; }
    button { background: linear-gradient(135deg, #0ff, #f0f); color: #000; font-weight: bold; }
    button.secondary { background: #333; color: #fff; }
    button.danger { background: #a33; color: #fff; }
    .row { display: flex; gap: 5px; align-items: center; }
    .btn-row { display: flex; gap: 4px; }
    .btn-row button { flex: 1; }
    .section { background: #1a1a1a; padding: 8px; border-radius: 6px; margin: 5px 0; }
    #objectList { max-height: 70px; overflow-y: auto; }
    .obj-item { display: flex; justify-content: space-between; padding: 3px 5px; background: #222; border-radius: 3px; margin: 2px 0; cursor: pointer; }
    .obj-item.selected { border: 1px solid #0ff; }
    .obj-item button { width: auto; padding: 2px 5px; }
    .mode-btns { display: flex; gap: 4px; margin-bottom: 8px; }
    .mode-btns button { flex: 1; }
    .mode-btns button.active { background: #0ff; color: #000; }
    .axis-btns { display: flex; gap: 4px; margin: 5px 0; }
    .axis-btns button { flex: 1; padding: 4px; }
    .axis-btns button.active-x { background: #e74c3c; color: #fff; }
    .axis-btns button.active-y { background: #2ecc71; color: #fff; }
    .axis-btns button.active-z { background: #3498db; color: #fff; }
    #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #0ff; color: #000; padding: 8px 16px; border-radius: 6px; font-weight: bold; display: none; z-index: 10000; }
    #statusBar { position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 5px 10px; border-radius: 6px; color: #0ff; font-family: monospace; font-size: 11px; z-index: 9999; }
  </style>
</head>
<body>
  <div id="ui">
    <h2>ü•Ω Editor 3D VR</h2>
    
    <div class="mode-btns">
      <button id="modeSelect" class="active" onclick="setMode('select')">üéØ Selecionar</button>
      <button id="modeMove" onclick="setMode('move')">‚úã Mover</button>
    </div>
    
    <label>Eixo de movimento:</label>
    <div class="axis-btns">
      <button id="axisX" class="active-x" onclick="setAxis('x')">X</button>
      <button id="axisY" onclick="setAxis('y')">Y</button>
      <button id="axisZ" onclick="setAxis('z')">Z</button>
    </div>
    <label><input type="checkbox" id="snapEnabled"> Snap to Grid (0.5)</label>
    
    <div class="section">
      <label>Adicionar:</label>
      <select id="shapeType">
        <option value="sphere">Esfera</option>
        <option value="box">Cubo</option>
        <option value="torus">Torus</option>
        <option value="cone">Cone</option>
        <option value="cylinder">Cilindro</option>
      </select>
      <button onclick="addObject()">+ Adicionar</button>
    </div>
    
    <h3>üì¶ Objetos</h3>
    <div id="objectList"></div>
    <div class="btn-row">
      <button onclick="duplicateSelected()" class="secondary">‚ßâ Duplicar</button>
      <button onclick="deleteSelected()" class="danger">üóëÔ∏è Excluir</button>
    </div>
    
    <h3>üìê Transforma√ß√µes</h3>
    <div class="section">
      <label>Escala: <span id="scaleVal">1.0</span></label>
      <input type="range" id="scale" min="0.1" max="5" step="0.1" value="1" oninput="updateTransform()">
      <label style="color:#e74c3c">Pos X: <span id="posXVal">0</span></label>
      <input type="range" id="posX" min="-10" max="10" step="0.1" value="0" oninput="updateTransform()">
      <label style="color:#2ecc71">Pos Y: <span id="posYVal">1</span></label>
      <input type="range" id="posY" min="0" max="10" step="0.1" value="1" oninput="updateTransform()">
      <label style="color:#3498db">Pos Z: <span id="posZVal">0</span></label>
      <input type="range" id="posZ" min="-15" max="5" step="0.1" value="0" oninput="updateTransform()">
    </div>
    
    <h3>üé¨ Anima√ß√£o</h3>
    <div class="section">
      <label><input type="checkbox" id="animEnabled" onchange="updateAnimation()"> Rota√ß√£o autom√°tica</label>
      <label>Velocidade: <span id="animSpeedVal">2000</span>ms</label>
      <input type="range" id="animSpeed" min="500" max="10000" step="100" value="2000" oninput="updateAnimation()">
    </div>
    
    <h3>üé® Presets</h3>
    <div class="btn-row">
      <button class="secondary" onclick="applyPreset('glass')">Vidro</button>
      <button class="secondary" onclick="applyPreset('metal')">Metal</button>
      <button class="secondary" onclick="applyPreset('gold')">Ouro</button>
    </div>
    <div class="btn-row">
      <button class="secondary" onclick="applyPreset('neon')">Neon</button>
      <button class="secondary" onclick="applyPreset('glow')">Glow</button>
      <button class="secondary" onclick="applyPreset('chrome')">Chrome</button>
    </div>
    
    <h3>üé® Material</h3>
    <div class="section">
      <div class="row">
        <label>Cor:</label>
        <input type="color" id="color" value="#4CC3D9" onchange="updateMaterial()">
        <label>Emissivo:</label>
        <input type="color" id="emissive" value="#000000" onchange="updateMaterial()">
      </div>
      <label>Metalness: <span id="metalnessVal">0.00</span></label>
      <input type="range" id="metalness" min="0" max="1" step="0.01" value="0" oninput="updateMaterial()">
      <label>Roughness: <span id="roughnessVal">0.50</span></label>
      <input type="range" id="roughness" min="0" max="1" step="0.01" value="0.5" oninput="updateMaterial()">
    </div>
    
    <h3>üíæ Cena</h3>
    <div class="btn-row">
      <button onclick="exportScene()" class="secondary">Salvar</button>
      <button onclick="document.getElementById('importFile').click()" class="secondary">Carregar</button>
      <input type="file" id="importFile" accept=".json" style="display:none" onchange="importScene(event)">
    </div>
  </div>
  
  <div id="statusBar">Modo: Selecionar | Eixo: X | Objeto: Nenhum</div>
  <div id="toast"></div>

  <a-scene id="scene" vr-mode-ui="enabled: true">
    <a-entity id="rig" position="0 1.6 8">
      <a-camera id="camera" look-controls wasd-controls="acceleration: 30"></a-camera>
    </a-entity>
    
    <a-light type="ambient" color="#666" intensity="0.5"></a-light>
    <a-light type="directional" color="#fff" intensity="0.8" position="2 4 2"></a-light>
    <a-light type="point" color="#0ff" intensity="0.5" position="4 3 4"></a-light>
    <a-light type="point" color="#f0f" intensity="0.5" position="-4 3 -4"></a-light>
    
    <a-sky color="#1a1a2e"></a-sky>
    <a-plane id="ground" rotation="-90 0 0" width="30" height="30" color="#222"></a-plane>
    <a-entity id="grid" position="0 0.01 0"></a-entity>
    
    <a-entity id="gizmo" visible="false">
      <a-cylinder position="0.6 0 0" rotation="0 0 90" radius="0.02" height="1.2" color="#e74c3c" material="shader:flat"></a-cylinder>
      <a-cone position="1.25 0 0" rotation="0 0 -90" radius-bottom="0.06" height="0.15" color="#e74c3c" material="shader:flat"></a-cone>
      <a-cylinder position="0 0.6 0" radius="0.02" height="1.2" color="#2ecc71" material="shader:flat"></a-cylinder>
      <a-cone position="0 1.25 0" radius-bottom="0.06" height="0.15" color="#2ecc71" material="shader:flat"></a-cone>
      <a-cylinder position="0 0 0.6" rotation="90 0 0" radius="0.02" height="1.2" color="#3498db" material="shader:flat"></a-cylinder>
      <a-cone position="0 0 1.25" rotation="-90 0 0" radius-bottom="0.06" height="0.15" color="#3498db" material="shader:flat"></a-cone>
      <a-sphere radius="0.06" color="#fff" material="shader:flat"></a-sphere>
    </a-entity>
    
    <a-entity id="objectsContainer"></a-entity>
  </a-scene>

  <script>
    let objects = [];
    let selectedObject = null;
    let objectId = 0;
    let currentMode = 'select';
    let currentAxis = 'x';
    let isDragging = false;
    let dragStart = { x: 0, y: 0 };
    let objStartPos = null;
    
    const container = document.getElementById('objectsContainer');
    const gizmo = document.getElementById('gizmo');
    const camera = document.getElementById('camera');
    
    function setMode(mode) {
      currentMode = mode;
      document.getElementById('modeSelect').classList.toggle('active', mode === 'select');
      document.getElementById('modeMove').classList.toggle('active', mode === 'move');
      
      // Desabilita look-controls no modo mover para n√£o conflitar
      camera.setAttribute('look-controls', 'enabled', mode === 'select');
      
      updateStatus();
    }
    
    function setAxis(axis) {
      currentAxis = axis;
      document.getElementById('axisX').className = axis === 'x' ? 'active-x' : '';
      document.getElementById('axisY').className = axis === 'y' ? 'active-y' : '';
      document.getElementById('axisZ').className = axis === 'z' ? 'active-z' : '';
      updateStatus();
    }
    
    function updateStatus() {
      const name = selectedObject ? selectedObject.userData.name : 'Nenhum';
      document.getElementById('statusBar').textContent = 
        `Modo: ${currentMode === 'select' ? 'Selecionar' : 'Mover'} | Eixo: ${currentAxis.toUpperCase()} | Objeto: ${name}`;
    }
    
    function snap(val) {
      return document.getElementById('snapEnabled').checked ? Math.round(val * 2) / 2 : val;
    }
    
    function createGrid() {
      const grid = document.getElementById('grid');
      for (let i = -10; i <= 10; i++) {
        const lx = document.createElement('a-entity');
        lx.setAttribute('line', `start: -10 0 ${i}; end: 10 0 ${i}; color: #444`);
        grid.appendChild(lx);
        const lz = document.createElement('a-entity');
        lz.setAttribute('line', `start: ${i} 0 -10; end: ${i} 0 10; color: #444`);
        grid.appendChild(lz);
      }
    }
    
    function addObject(type = null) {
      type = type || document.getElementById('shapeType').value;
      const el = document.createElement('a-entity');
      el.setAttribute('id', `obj_${objectId}`);
      el.setAttribute('class', 'clickable');
      
      let geom = `primitive: ${type}`;
      if (type === 'sphere') geom += '; radius: 0.5; segmentsWidth: 32; segmentsHeight: 32';
      else if (type === 'box') geom += '; width: 1; height: 1; depth: 1';
      else if (type === 'torus') geom += '; radius: 0.5; radiusTubular: 0.15';
      else if (type === 'cone') geom += '; radiusBottom: 0.5; radiusTop: 0; height: 1';
      else if (type === 'cylinder') geom += '; radius: 0.4; height: 1';
      
      el.setAttribute('geometry', geom);
      el.setAttribute('material', 'color: #4CC3D9; metalness: 0; roughness: 0.5');
      el.setAttribute('position', '0 1 0');
      
      el.userData = { id: `obj_${objectId}`, type, name: `${type}_${objectId}`, animation: { enabled: false, speed: 2000 } };
      objectId++;
      
      container.appendChild(el);
      objects.push(el);
      selectObject(el);
      updateObjectList();
      showToast(`${type} adicionado!`);
      return el;
    }
    
    function selectObject(el) {
      selectedObject = el;
      gizmo.setAttribute('visible', !!el);
      if (el) { updateGizmo(); updateUI(); }
      updateObjectList();
      updateStatus();
    }
    
    function updateGizmo() {
      if (!selectedObject) return;
      const pos = selectedObject.getAttribute('position');
      gizmo.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
    }
    
    function updateUI() {
      if (!selectedObject) return;
      const pos = selectedObject.getAttribute('position');
      const scale = selectedObject.getAttribute('scale') || {x:1,y:1,z:1};
      const mat = selectedObject.getAttribute('material') || {};
      
      document.getElementById('scale').value = scale.x;
      document.getElementById('scaleVal').textContent = scale.x.toFixed(1);
      document.getElementById('posX').value = pos.x;
      document.getElementById('posXVal').textContent = pos.x.toFixed(1);
      document.getElementById('posY').value = pos.y;
      document.getElementById('posYVal').textContent = pos.y.toFixed(1);
      document.getElementById('posZ').value = pos.z;
      document.getElementById('posZVal').textContent = pos.z.toFixed(1);
      document.getElementById('color').value = mat.color || '#4CC3D9';
      document.getElementById('metalness').value = mat.metalness || 0;
      document.getElementById('metalnessVal').textContent = (mat.metalness || 0).toFixed(2);
      document.getElementById('roughness').value = mat.roughness ?? 0.5;
      document.getElementById('roughnessVal').textContent = (mat.roughness ?? 0.5).toFixed(2);
      
      const anim = selectedObject.userData?.animation || { enabled: false, speed: 2000 };
      document.getElementById('animEnabled').checked = anim.enabled;
      document.getElementById('animSpeed').value = anim.speed;
      document.getElementById('animSpeedVal').textContent = anim.speed;
    }
    
    function updateTransform() {
      if (!selectedObject) return;
      const s = parseFloat(document.getElementById('scale').value);
      const px = parseFloat(document.getElementById('posX').value);
      const py = parseFloat(document.getElementById('posY').value);
      const pz = parseFloat(document.getElementById('posZ').value);
      
      document.getElementById('scaleVal').textContent = s.toFixed(1);
      document.getElementById('posXVal').textContent = px.toFixed(1);
      document.getElementById('posYVal').textContent = py.toFixed(1);
      document.getElementById('posZVal').textContent = pz.toFixed(1);
      
      selectedObject.setAttribute('scale', `${s} ${s} ${s}`);
      selectedObject.setAttribute('position', `${px} ${py} ${pz}`);
      updateGizmo();
    }
    
    function updateMaterial() {
      if (!selectedObject) return;
      const color = document.getElementById('color').value;
      const emissive = document.getElementById('emissive').value;
      const metalness = parseFloat(document.getElementById('metalness').value);
      const roughness = parseFloat(document.getElementById('roughness').value);
      
      document.getElementById('metalnessVal').textContent = metalness.toFixed(2);
      document.getElementById('roughnessVal').textContent = roughness.toFixed(2);
      
      selectedObject.setAttribute('material', { color, emissive, metalness, roughness });
    }
    
    function updateAnimation() {
      if (!selectedObject) return;
      const enabled = document.getElementById('animEnabled').checked;
      const speed = parseInt(document.getElementById('animSpeed').value);
      document.getElementById('animSpeedVal').textContent = speed;
      
      selectedObject.userData.animation = { enabled, speed };
      selectedObject.removeAttribute('animation__rot');
      
      if (enabled) {
        selectedObject.setAttribute('animation__rot', {
          property: 'rotation', to: '0 360 0', dur: speed, loop: true, easing: 'linear'
        });
      }
    }
    
    const presets = {
      glass: { color: '#ffffff', metalness: 0, roughness: 0 },
      metal: { color: '#888888', metalness: 1, roughness: 0.2 },
      gold: { color: '#ffd700', metalness: 1, roughness: 0.1 },
      chrome: { color: '#cccccc', metalness: 1, roughness: 0.05 },
      neon: { color: '#00ff88', metalness: 0, roughness: 0.5 },
      glow: { color: '#ff00ff', metalness: 0, roughness: 0.3 }
    };
    
    function applyPreset(name) {
      if (!selectedObject) return;
      const p = presets[name];
      document.getElementById('color').value = p.color;
      document.getElementById('metalness').value = p.metalness;
      document.getElementById('roughness').value = p.roughness;
      updateMaterial();
      showToast(`Preset: ${name}`);
    }
    
    function updateObjectList() {
      document.getElementById('objectList').innerHTML = objects.map(obj => `
        <div class="obj-item ${obj === selectedObject ? 'selected' : ''}" onclick="selectObject(objects.find(o=>o.userData.id==='${obj.userData.id}'))">
          <span>${obj.userData.name}</span>
          <button onclick="event.stopPropagation(); deleteObject('${obj.userData.id}')" class="danger">‚úï</button>
        </div>
      `).join('');
    }
    
    function deleteObject(id) {
      const obj = objects.find(o => o.userData.id === id);
      if (!obj) return;
      obj.parentNode.removeChild(obj);
      objects = objects.filter(o => o !== obj);
      if (selectedObject === obj) selectObject(objects[0] || null);
      updateObjectList();
      showToast('Exclu√≠do!');
    }
    
    function deleteSelected() { if (selectedObject) deleteObject(selectedObject.userData.id); }
    
    function duplicateSelected() {
      if (!selectedObject) return;
      const newObj = addObject(selectedObject.userData.type);
      const pos = selectedObject.getAttribute('position');
      const scale = selectedObject.getAttribute('scale');
      const mat = selectedObject.getAttribute('material');
      newObj.setAttribute('position', `${pos.x + 0.5} ${pos.y} ${pos.z + 0.5}`);
      if (scale) newObj.setAttribute('scale', scale);
      newObj.setAttribute('material', mat);
      showToast('Duplicado!');
    }
    
    function exportScene() {
      const data = { objects: objects.map(obj => ({
        type: obj.userData.type, name: obj.userData.name,
        position: obj.getAttribute('position'),
        scale: obj.getAttribute('scale'),
        material: obj.getAttribute('material'),
        animation: obj.userData.animation
      }))};
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
      a.download = `cena_${Date.now()}.json`; a.click();
      showToast('Salvo!');
    }
    
    function importScene(e) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);
          objects.forEach(obj => obj.parentNode.removeChild(obj));
          objects = [];
          data.objects.forEach(d => {
            const obj = addObject(d.type);
            obj.userData.name = d.name;
            obj.setAttribute('position', d.position);
            if (d.scale) obj.setAttribute('scale', d.scale);
            if (d.material) obj.setAttribute('material', d.material);
            obj.userData.animation = d.animation;
          });
          selectObject(objects[0] || null);
          showToast('Carregado!');
        } catch { showToast('Erro!'); }
      };
      reader.readAsText(file);
      e.target.value = '';
    }
    
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg; toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 1500);
    }
    
    // Mouse - arrasto de objetos no modo Mover
    document.addEventListener('mousedown', (e) => {
      if (e.target.closest('#ui')) return;
      if (currentMode === 'move' && selectedObject && e.button === 0) {
        isDragging = true;
        dragStart = { x: e.clientX, y: e.clientY };
        objStartPos = { ...selectedObject.getAttribute('position') };
      }
    });
    
    document.addEventListener('mousemove', (e) => {
      if (!isDragging || !selectedObject || !objStartPos) return;
      
      const dx = (e.clientX - dragStart.x) * 0.02;
      const dy = (dragStart.y - e.clientY) * 0.02;
      
      const pos = { ...objStartPos };
      if (currentAxis === 'x') pos.x = snap(objStartPos.x + dx);
      else if (currentAxis === 'y') pos.y = snap(Math.max(0.1, objStartPos.y + dy));
      else if (currentAxis === 'z') pos.z = snap(objStartPos.z - dy);
      
      selectedObject.setAttribute('position', pos);
      updateGizmo();
      updateUI();
    });
    
    document.addEventListener('mouseup', () => { isDragging = false; objStartPos = null; });
    
    // Click para selecionar
    document.querySelector('a-scene').addEventListener('click', (e) => {
      if (e.target.closest('#ui') || currentMode !== 'select') return;
      const el = e.target.closest('[id^="obj_"]');
      if (el) {
        const obj = objects.find(o => o.id === el.id);
        if (obj) selectObject(obj);
      }
    });
    
    // Teclado
    document.addEventListener('keydown', (e) => {
      if (e.target.tagName === 'INPUT') return;
      if (e.key === 'Delete') deleteSelected();
      if (e.ctrlKey && e.key === 'd') { e.preventDefault(); duplicateSelected(); }
      if (e.key === 'm') setMode(currentMode === 'select' ? 'move' : 'select');
      if (e.key === 'x') setAxis('x');
      if (e.key === 'y') setAxis('y');
      if (e.key === 'z') setAxis('z');
    });
    
    // Init
    document.querySelector('a-scene').addEventListener('loaded', () => {
      createGrid();
      addObject('sphere');
    });
  </script>
</body>
</html>