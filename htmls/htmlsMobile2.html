<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Editor HTML Pro + AI</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'><text y='1.2em' font-size='90'>üöÄ</text></svg>">

  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@19.2.0",
      "react-dom/client": "https://esm.sh/react-dom@19.2.0/client",
      "@google/genai": "https://esm.sh/@google/genai@1.34.0"
    }
  }
  </script>

  <style>
    :root{--bg-main:#101014;--bg-panel:#17171c;--bg-header:#111117;--border:#23232e;--accent:#6366f1;--accent-hover:#4f46e5;--text-main:#e9e9ed;--text-muted:#9ca3af;--success:#10b981;--danger:#ef4444;--warning:#f59e0b}
    [data-theme="light"]{--bg-main:#f5f5f7;--bg-panel:#ffffff;--bg-header:#fafafa;--border:#e0e0e5;--text-main:#1a1a1a;--text-muted:#6b7280}
    *{box-sizing:border-box}
    html,body{width:100%;height:100%;margin:0;padding:0;overflow:hidden;font-family:Inter,system-ui,sans-serif;background:var(--bg-main);color:var(--text-main);transition:background .3s,color .3s}
    #root{display:flex;flex-direction:column;height:100dvh}
    .header{background:var(--bg-header);padding:0 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;height:48px;flex-shrink:0;gap:8px}
    .header h1{font-size:14px;margin:0;font-weight:800;display:flex;align-items:center;gap:6px;white-space:nowrap}
    .header-right{display:flex;gap:6px;align-items:center}
    .unsaved-dot{width:8px;height:8px;background:var(--warning);border-radius:50%;animation:pulse 1.5s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
    .main-container{flex:1;display:flex;overflow:hidden;position:relative;min-height:0;height:calc(100vh - 48px)}
    .editor-section{width:50%;display:flex;flex-direction:column;background:var(--bg-panel);border-right:1px solid var(--border);min-width:300px}
    .preview-section{flex:1;background:#fff;display:flex;flex-direction:column}
    .controls-panel{padding:8px 10px;background:var(--bg-header);border-bottom:1px solid var(--border);display:flex;gap:6px;align-items:center;flex-wrap:wrap}
    .input-group{display:flex;flex-direction:column;gap:2px;flex:1;min-width:120px}
    .input-group label{font-size:9px;color:var(--text-muted);font-weight:700;text-transform:uppercase}
    input[type="text"],input[type="password"],select{background:var(--bg-main);border:1px solid var(--border);color:var(--text-main);padding:6px 10px;border-radius:6px;outline:none;font-size:14px;height:34px;width:100%}
    input:focus,select:focus{border-color:var(--accent)}
    .btn{padding:0 12px;border-radius:8px;border:none;font-weight:700;cursor:pointer;font-size:12px;transition:all .15s;height:34px;display:flex;align-items:center;justify-content:center;gap:5px;white-space:nowrap;user-select:none;min-width:34px}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn:active:not(:disabled){transform:scale(.96)}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-primary:hover:not(:disabled){background:var(--accent-hover)}
    .btn-ai{background:linear-gradient(135deg,#6366f1,#a855f7);color:#fff}
    .btn-ai:hover:not(:disabled){filter:brightness(1.1)}
    .btn-secondary{background:var(--bg-main);color:var(--text-muted);border:1px solid var(--border)}
    .btn-secondary:hover:not(:disabled){color:var(--text-main);border-color:var(--accent)}
    .btn-icon{padding:0;width:34px;height:34px;font-size:14px}
    .tabs{display:flex;background:var(--bg-header);border-bottom:1px solid var(--border)}
    .tab{flex:1;padding:8px;text-align:center;cursor:pointer;font-size:11px;font-weight:800;color:var(--text-muted);border-right:1px solid var(--border);background:transparent;transition:all .15s;text-transform:uppercase}
    .tab:last-child{border-right:none}
    .tab.active{background:var(--bg-panel);color:var(--accent);border-bottom:2px solid var(--accent)}
    .tab:hover:not(.active){color:var(--text-main);background:rgba(99,102,241,.08)}
    .editor-container{flex:1;position:relative;overflow:hidden;display:flex;flex-direction:column;min-height:0;height:100%}
    .editor-wrapper{flex:1;display:flex;overflow:hidden;min-height:0}
    .line-numbers{width:36px;background:var(--bg-header);border-right:1px solid var(--border);padding:12px 6px;font-family:ui-monospace,monospace;font-size:12px;line-height:1.6;color:var(--text-muted);text-align:right;overflow:hidden;user-select:none}
    textarea.code-area{flex:1;background:var(--bg-panel);color:var(--text-main);border:none;padding:12px;font-family:ui-monospace,monospace;font-size:13px;line-height:1.6;resize:none;outline:none;tab-size:2}
    .search-bar{display:flex;gap:6px;padding:6px 10px;background:var(--bg-header);border-bottom:1px solid var(--border);align-items:center}
    .search-bar input{flex:1;height:30px;font-size:12px}
    iframe{width:100%;height:100%;border:none;background:#fff}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000;padding:14px}
    .modal-content{background:var(--bg-panel);border:1px solid var(--border);width:min(560px,100%);border-radius:14px;padding:18px;box-shadow:0 20px 50px rgba(0,0,0,.5);display:flex;flex-direction:column;gap:12px;max-height:90dvh;overflow:auto}
    .modal-title{font-size:16px;font-weight:900;color:var(--text-main);display:flex;align-items:center;gap:8px;margin:0}
    .modal-textarea{width:100%;min-height:100px;background:var(--bg-main);border:1px solid var(--border);border-radius:8px;color:var(--text-main);padding:10px;font-size:13px;resize:vertical;outline:none;font-family:inherit}
    .modal-textarea:focus{border-color:var(--accent)}
    .modal-actions{display:flex;justify-content:flex-end;gap:8px;flex-wrap:wrap}
    .prompt-chips{display:flex;flex-wrap:wrap;gap:6px}
    .prompt-chip{padding:5px 10px;background:var(--bg-main);border:1px solid var(--border);border-radius:16px;font-size:10px;color:var(--text-muted);cursor:pointer;transition:all .15s}
    .prompt-chip:hover{border-color:var(--accent);color:var(--accent)}
    .history-list{max-height:180px;overflow:auto;display:flex;flex-direction:column;gap:4px}
    .history-item{padding:8px 10px;background:var(--bg-main);border:1px solid var(--border);border-radius:6px;cursor:pointer;transition:all .15s}
    .history-item:hover{border-color:var(--accent)}
    .history-time{font-size:9px;color:var(--text-muted)}
    .history-preview{font-size:11px;color:var(--text-main);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .templates-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px}
    .template-card{padding:12px 8px;background:var(--bg-main);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .15s;text-align:center}
    .template-card:hover{border-color:var(--accent);transform:translateY(-2px)}
    .template-icon{font-size:24px;margin-bottom:6px}
    .template-name{font-size:10px;font-weight:700;color:var(--text-main)}
    .toast-container{position:fixed;bottom:70px;left:50%;transform:translateX(-50%);z-index:9999;display:flex;flex-direction:column;gap:6px;pointer-events:none}
    .toast{padding:8px 16px;border-radius:8px;font-size:12px;font-weight:700;box-shadow:0 4px 20px rgba(0,0,0,.4);animation:slideUp .25s ease;pointer-events:auto}
    @keyframes slideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
    .toast-info{background:#3b82f6;color:#fff}
    .toast-success{background:var(--success);color:#fff}
    .toast-error{background:var(--danger);color:#fff}
    .toast-warning{background:var(--warning);color:#fff}
    .fab{position:fixed;bottom:16px;right:16px;width:52px;height:52px;border-radius:50%;background:var(--accent);color:#fff;border:none;font-size:22px;cursor:pointer;box-shadow:0 4px 20px rgba(99,102,241,.5);display:none;align-items:center;justify-content:center;z-index:100;transition:all .15s}
    .fab:hover{transform:scale(1.08)}
    .fab:active{transform:scale(.95)}
    .spinner{width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .loading-overlay{position:absolute;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;color:white;flex-direction:column;gap:12px;z-index:10}
    .loading-overlay .spinner{width:40px;height:40px;border-width:3px}
    .settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .settings-grid .full{grid-column:1/-1}
    .toggle-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0}
    .toggle-row label{font-size:12px;color:var(--text-main)}
    .toggle-switch{position:relative;width:40px;height:22px;background:var(--bg-main);border:1px solid var(--border);border-radius:11px;cursor:pointer;transition:all .2s}
    .toggle-switch.active{background:var(--accent);border-color:var(--accent)}
    .toggle-switch::after{content:'';position:absolute;top:2px;left:2px;width:16px;height:16px;background:#fff;border-radius:50%;transition:transform .2s}
    .toggle-switch.active::after{transform:translateX(18px)}
    .mobile-toggle{display:none}
    .file-list-modal{max-height:300px;overflow:auto}
    .file-item{padding:10px 12px;display:flex;justify-content:space-between;align-items:center;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .15s;margin-bottom:6px;background:var(--bg-main)}
    .file-item:hover{border-color:var(--accent);background:rgba(99,102,241,.1)}
    .file-item.active{border-color:var(--accent);background:rgba(99,102,241,.15)}
    .file-name{font-size:13px;color:var(--accent);font-weight:700}
    .btn-del{background:rgba(239,68,68,.2);color:#fca5a5;width:28px;height:28px;font-size:12px;border-radius:6px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center}
    .btn-del:hover{background:rgba(239,68,68,.4)}
    .empty-msg{padding:20px;text-align:center;color:var(--text-muted);font-size:12px}
    @media(max-width:860px){
      .main-container{flex-direction:column}
      .editor-section,.preview-section{width:100%;height:100%;min-width:0}
      .editor-section{border-right:none}
      .mobile-toggle{display:flex;gap:4px}
      .header h1{font-size:12px}
      .header h1 .title-text{display:none}
      .fab{display:flex}
      .line-numbers{display:none}
      .btn{padding:0 8px;font-size:11px;height:32px}
      .btn-icon{width:32px;height:32px}
      input[type="text"],input[type="password"],select{font-size:16px;height:32px}
    }
    .is-mobile .editor-section{display:flex}
    .is-mobile .preview-section{display:flex}
    .is-mobile.mobile-show-editor .preview-section{display:none}
    .is-mobile.mobile-show-preview .editor-section{display:none}
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import React, { useEffect, useRef, useState, useCallback } from "react";
    import { createRoot } from "react-dom/client";
    import { GoogleGenAI, Type } from "@google/genai";

    const DEFAULT_SETTINGS = { githubToken:"", githubOwner:"", githubRepo:"", githubPath:"htmls", githubBranch:"main", geminiApiKey:"", theme:"dark", autoSave:true, showLineNumbers:true };
    const STORAGE_KEY = "htmls_editor_pro_v5";
    const HISTORY_KEY = "htmls_editor_history_v2";
    const AUTOSAVE_KEY = "htmls_editor_autosave_v2";
    const MAX_HISTORY = 15;

    const TEMPLATES = [
      { id:"blank", name:"Em Branco", icon:"üìÑ", html:"<h1>Nova P√°gina</h1>\n<p>Comece aqui...</p>", css:"body{font-family:system-ui;padding:20px;background:#f5f5f5}h1{color:#333}", js:"console.log('Ol√°!');" },
      { id:"landing", name:"Landing", icon:"üöÄ", html:`<header class="hero">\n  <nav><div class="logo">Marca</div></nav>\n  <div class="content">\n    <h1>T√≠tulo Principal</h1>\n    <p>Subt√≠tulo da p√°gina</p>\n    <button class="cta">Come√ßar</button>\n  </div>\n</header>\n<section class="features">\n  <div class="card">‚ö° R√°pido</div>\n  <div class="card">üîí Seguro</div>\n  <div class="card">üì± Responsivo</div>\n</section>`, css:`*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui}.hero{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:60px 20px;text-align:center;min-height:60vh;display:flex;flex-direction:column;justify-content:center}.logo{font-size:20px;font-weight:bold;margin-bottom:40px}h1{font-size:2.5rem;margin-bottom:15px}p{font-size:1.1rem;opacity:.9;margin-bottom:25px}.cta{background:#fff;color:#667eea;border:none;padding:12px 30px;font-size:16px;font-weight:bold;border-radius:25px;cursor:pointer}.features{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;padding:40px 20px;background:#f8f9fa}.card{background:#fff;padding:30px;border-radius:12px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,.1)}`, js:`document.querySelector('.cta').onclick=()=>alert('Clicou!');` },
      { id:"form", name:"Formul√°rio", icon:"üìù", html:`<div class="form-box">\n  <h1>Contato</h1>\n  <form id="form">\n    <input type="text" placeholder="Nome" required>\n    <input type="email" placeholder="E-mail" required>\n    <textarea placeholder="Mensagem" rows="4" required></textarea>\n    <button type="submit">Enviar</button>\n  </form>\n</div>`, css:`*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.form-box{background:#fff;padding:35px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.1);width:100%;max-width:400px}h1{text-align:center;margin-bottom:25px;color:#333}input,textarea{width:100%;padding:12px;margin-bottom:15px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;font-family:inherit}input:focus,textarea:focus{outline:none;border-color:#667eea}button{width:100%;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer}button:hover{opacity:.9}`, js:`document.getElementById('form').onsubmit=e=>{e.preventDefault();alert('Enviado!');e.target.reset()};` },
      { id:"dashboard", name:"Dashboard", icon:"üìä", html:`<div class="dash">\n  <aside><div class="logo">üìä</div><nav><a class="active">üè† Home</a><a>üìà Stats</a><a>‚öôÔ∏è Config</a></nav></aside>\n  <main>\n    <h1>Dashboard</h1>\n    <div class="cards">\n      <div class="stat">üë•<span>1,234</span><small>Usu√°rios</small></div>\n      <div class="stat">üí∞<span>R$45k</span><small>Receita</small></div>\n      <div class="stat">üì¶<span>892</span><small>Pedidos</small></div>\n    </div>\n  </main>\n</div>`, css:`*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui}.dash{display:flex;min-height:100vh}aside{width:200px;background:#1a1a2e;color:#fff;padding:20px}aside .logo{font-size:28px;text-align:center;margin-bottom:30px}nav a{display:block;padding:12px;color:rgba(255,255,255,.7);text-decoration:none;border-radius:8px;margin-bottom:5px}nav a:hover,nav a.active{background:rgba(255,255,255,.1);color:#fff}main{flex:1;padding:30px;background:#f0f2f5}h1{margin-bottom:25px}.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px}.stat{background:#fff;padding:25px;border-radius:12px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,.05)}.stat span{display:block;font-size:28px;font-weight:bold;margin:10px 0}.stat small{color:#888}@media(max-width:600px){aside{display:none}}`, js:`console.log('Dashboard carregado');` },
      { id:"portfolio", name:"Portf√≥lio", icon:"üé®", html:`<header>\n  <nav><a class="logo">Jo√£o</a><div><a href="#work">Trabalhos</a><a href="#contact">Contato</a></div></nav>\n</header>\n<section class="hero"><h1>Designer & Dev</h1><p>Criando experi√™ncias digitais</p></section>\n<section id="work" class="work"><h2>Trabalhos</h2><div class="grid"><div class="item">üñºÔ∏è Projeto 1</div><div class="item">üé® Projeto 2</div><div class="item">üíª Projeto 3</div></div></section>\n<section id="contact" class="contact"><h2>Contato</h2><a href="mailto:oi@email.com" class="btn">Enviar E-mail</a></section>`, css:`*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui}nav{display:flex;justify-content:space-between;padding:20px;position:fixed;width:100%;background:rgba(255,255,255,.95);z-index:10}.logo{font-weight:bold;font-size:18px;text-decoration:none;color:#333}nav div a{margin-left:20px;text-decoration:none;color:#666}.hero{height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;text-align:center}h1{font-size:3rem;margin-bottom:15px}section{padding:80px 20px;text-align:center}h2{font-size:2rem;margin-bottom:40px}.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;max-width:800px;margin:0 auto}.item{background:#f5f5f5;padding:40px;border-radius:12px;font-size:18px}.contact .btn{display:inline-block;padding:15px 35px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;text-decoration:none;border-radius:25px;font-weight:bold}`, js:`document.querySelectorAll('a[href^="#"]').forEach(a=>a.onclick=e=>{e.preventDefault();document.querySelector(a.getAttribute('href')).scrollIntoView({behavior:'smooth'})});` },
      { id:"ecommerce", name:"Loja", icon:"üõí", html:`<header><div class="logo">üõçÔ∏è Loja</div><button class="cart-btn">üõí <span id="count">0</span></button></header>\n<main>\n  <h1>Produtos</h1>\n  <div class="products" id="products"></div>\n</main>`, css:`*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui;background:#f5f5f5}header{background:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,.1);position:sticky;top:0;z-index:10}.logo{font-size:20px;font-weight:bold}.cart-btn{background:#333;color:#fff;border:none;padding:10px 18px;border-radius:20px;cursor:pointer;font-size:14px}#count{background:#e74c3c;padding:2px 8px;border-radius:10px;margin-left:5px}main{padding:30px 20px;max-width:1000px;margin:0 auto}h1{text-align:center;margin-bottom:30px}.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px}.product{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.08)}.product-img{height:150px;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);display:flex;align-items:center;justify-content:center;font-size:50px}.product-info{padding:15px}.product-name{font-weight:bold;margin-bottom:8px}.product-price{color:#27ae60;font-size:20px;font-weight:bold;margin-bottom:12px}.add-btn{width:100%;padding:10px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:6px;font-weight:bold;cursor:pointer}`, js:`const products=[{id:1,name:'Produto 1',price:99.90,icon:'üëü'},{id:2,name:'Produto 2',price:149.90,icon:'üëï'},{id:3,name:'Produto 3',price:199.90,icon:'üéí'},{id:4,name:'Produto 4',price:79.90,icon:'üß¢'}];let cart=0;const container=document.getElementById('products');products.forEach(p=>{container.innerHTML+=\`<div class="product"><div class="product-img">\${p.icon}</div><div class="product-info"><div class="product-name">\${p.name}</div><div class="product-price">R$ \${p.price.toFixed(2)}</div><button class="add-btn" onclick="addCart()">Adicionar</button></div></div>\`});function addCart(){cart++;document.getElementById('count').textContent=cart}` }
    ];

    const PROMPT_SUGGESTIONS = ["Landing page para pizzaria","Formul√°rio de cadastro moderno","Dashboard de vendas","Portf√≥lio minimalista","P√°gina de produto","Blog pessoal"];

    class GitHubService {
      constructor(s){ this.s = s; }
      update(s){ this.s = s; }
      get headers(){ return { "Authorization":`Bearer ${this.s.githubToken}`, "Accept":"application/vnd.github+json", "Content-Type":"application/json" }; }
      get ok(){ return !!(this.s.githubToken && this.s.githubOwner && this.s.githubRepo); }
      async list(){
        if(!this.ok) return [];
        const r = await fetch(`https://api.github.com/repos/${this.s.githubOwner}/${this.s.githubRepo}/contents/${this.s.githubPath}?ref=${this.s.githubBranch}`,{headers:this.headers});
        if(!r.ok) return r.status===404 ? [] : Promise.reject(new Error(r.statusText));
        const f = await r.json();
        return Array.isArray(f) ? f.filter(x=>x.name.endsWith(".html")).sort((a,b)=>a.name.localeCompare(b.name)) : [];
      }
      async get(name){
        const r = await fetch(`https://api.github.com/repos/${this.s.githubOwner}/${this.s.githubRepo}/contents/${this.s.githubPath}/${name}?ref=${this.s.githubBranch}`,{headers:this.headers});
        if(!r.ok) throw new Error("Arquivo n√£o encontrado");
        const d = await r.json();
        return { content: new TextDecoder().decode(Uint8Array.from(atob(d.content.replace(/\s/g,"")),c=>c.charCodeAt(0))), sha: d.sha };
      }
      async save(name, content){
        const path = `${this.s.githubPath}/${name}`;
        const url = `https://api.github.com/repos/${this.s.githubOwner}/${this.s.githubRepo}/contents/${path}`;
        let sha = null;
        try { sha = (await this.get(name)).sha; } catch(_){}
        const encoded = btoa(String.fromCharCode(...new TextEncoder().encode(content)));
        const body = { message:`Update ${name}`, content:encoded, branch:this.s.githubBranch, ...(sha?{sha}:{}) };
        const r = await fetch(url,{method:"PUT",headers:this.headers,body:JSON.stringify(body)});
        if(!r.ok){ let e={}; try{e=await r.json();}catch(_){} throw new Error(e.message||"Erro ao salvar"); }
        return r.json();
      }
      async del(name){
        const f = await this.get(name);
        const r = await fetch(`https://api.github.com/repos/${this.s.githubOwner}/${this.s.githubRepo}/contents/${this.s.githubPath}/${name}`,{method:"DELETE",headers:this.headers,body:JSON.stringify({message:`Delete ${name}`,sha:f.sha,branch:this.s.githubBranch})});
        if(!r.ok) throw new Error("Erro ao deletar");
      }
    }

    const isMobileNow = () => window.matchMedia?.("(max-width:860px)").matches;

    function App(){
      const [html,setHtml] = useState("<h1>Ol√° Mundo!</h1>");
      const [css,setCss] = useState("body{font-family:system-ui;padding:20px;background:#f0f0f0}h1{color:#333}");
      const [js,setJs] = useState('console.log("Carregado");');
      const [tab,setTab] = useState("html");
      const [filename,setFilename] = useState("index.html");
      const [files,setFiles] = useState([]);
      const [toasts,setToasts] = useState([]);
      const [saving,setSaving] = useState(false);
      const [aiLoading,setAiLoading] = useState(false);
      const [showAI,setShowAI] = useState(false);
      const [showSettings,setShowSettings] = useState(false);
      const [showTemplates,setShowTemplates] = useState(false);
      const [showHistory,setShowHistory] = useState(false);
      const [showFiles,setShowFiles] = useState(false);
      const [showSearch,setShowSearch] = useState(false);
      const [aiPrompt,setAiPrompt] = useState("");
      const [fullMode,setFullMode] = useState(false);
      const [hasChanges,setHasChanges] = useState(false);
      const [settings,setSettings] = useState(DEFAULT_SETTINGS);
      const [gh,setGh] = useState(new GitHubService(DEFAULT_SETTINGS));
      const [history,setHistory] = useState([]);
      const [searchText,setSearchText] = useState("");
      const [replaceText,setReplaceText] = useState("");
      const [loadingFiles,setLoadingFiles] = useState(false);
      const iframeRef = useRef(null);
      const [isMobile,setIsMobile] = useState(isMobileNow());
      const [mobilePane,setMobilePane] = useState("editor");
      const lastSaveRef = useRef({ html, css, js });
      const autoSaveTimer = useRef(null);

      const toast = useCallback((msg,type="info")=>{
        const id = Date.now();
        setToasts(t=>[...t,{id,msg,type}]);
        setTimeout(()=>setToasts(t=>t.filter(x=>x.id!==id)),3000);
      },[]);

      useEffect(()=>{
        const onResize = ()=>{ setIsMobile(isMobileNow()); };
        window.addEventListener("resize",onResize,{passive:true});
        return ()=>window.removeEventListener("resize",onResize);
      },[]);

      useEffect(()=>{
        document.body.classList.toggle("is-mobile",isMobile);
        document.body.classList.toggle("mobile-show-editor",isMobile && mobilePane==="editor");
        document.body.classList.toggle("mobile-show-preview",isMobile && mobilePane==="preview");
      },[isMobile,mobilePane]);

      useEffect(()=>{
        document.documentElement.setAttribute("data-theme",settings.theme);
      },[settings.theme]);

      useEffect(()=>{
        const saved = localStorage.getItem(STORAGE_KEY);
        if(saved){
          try{
            const p = JSON.parse(saved);
            setSettings(p);
            const svc = new GitHubService(p);
            setGh(svc);
          }catch(_){ setShowSettings(true); }
        }else{ setShowSettings(true); }
        const hist = localStorage.getItem(HISTORY_KEY);
        if(hist) try{ setHistory(JSON.parse(hist)); }catch(_){}
        const auto = localStorage.getItem(AUTOSAVE_KEY);
        if(auto){
          try{
            const a = JSON.parse(auto);
            if(a.html || a.css || a.js){
              setHtml(a.html||""); setCss(a.css||""); setJs(a.js||"");
              setFilename(a.filename||"index.html");
              setFullMode(a.fullMode||false);
              toast("Recuperado do auto-save","info");
            }
          }catch(_){}
        }
      },[]);

      useEffect(()=>{
        const changed = html !== lastSaveRef.current.html || css !== lastSaveRef.current.css || js !== lastSaveRef.current.js;
        setHasChanges(changed);
      },[html,css,js]);

      useEffect(()=>{
        if(!settings.autoSave) return;
        if(autoSaveTimer.current) clearTimeout(autoSaveTimer.current);
        autoSaveTimer.current = setTimeout(()=>{
          localStorage.setItem(AUTOSAVE_KEY, JSON.stringify({html,css,js,filename,fullMode}));
        }, 5000);
        return ()=>clearTimeout(autoSaveTimer.current);
      },[html,css,js,filename,fullMode,settings.autoSave]);

      const saveToHistory = useCallback(()=>{
        const entry = { time:Date.now(), html, css, js, filename, fullMode };
        setHistory(h=>{
          const newH = [entry,...h].slice(0,MAX_HISTORY);
          localStorage.setItem(HISTORY_KEY, JSON.stringify(newH));
          return newH;
        });
      },[html,css,js,filename,fullMode]);

      const refreshFiles = async ()=>{
        if(!gh.ok){ toast("Configure o GitHub primeiro","warning"); return; }
        setLoadingFiles(true);
        try{ 
          const f = await gh.list(); 
          setFiles(f);
          if(f.length===0) toast("Nenhum arquivo encontrado","info");
        }
        catch(e){ toast("Erro: "+e.message,"error"); }
        finally{ setLoadingFiles(false); }
      };

      const handleOpenFiles = async ()=>{
        setShowFiles(true);
        if(files.length===0) await refreshFiles();
      };

      const buildFull = ()=> fullMode ? html : `<!DOCTYPE html>\n<html lang="pt-BR">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width,initial-scale=1.0">\n  <title>${filename}</title>\n  <style>\n${css}\n  </style>\n</head>\n<body>\n${html}\n  <script>\n${js}\n  <\/script>\n</body>\n</html>`;

      const toggleMode = ()=>{
        if(fullMode){
          try{
            const doc = new DOMParser().parseFromString(html,"text/html");
            const st = doc.querySelector("head style");
            setCss(st?.innerHTML.trim()||"");
            st?.remove();
            let jsC = "";
            doc.querySelectorAll("body script").forEach(s=>{ if(s.innerHTML.trim()){ jsC+=s.innerHTML.trim()+"\n"; s.remove(); }});
            setJs(jsC.trim());
            setHtml(doc.body?.innerHTML.trim()||"");
            setFullMode(false);
            toast("Modo: Abas","info");
          }catch(_){ toast("Erro ao separar","error"); }
        }else{
          setHtml(buildFull());
          setCss(""); setJs("");
          setFullMode(true);
          toast("Modo: Completo","info");
        }
      };

      const handleSaveSettings = (s)=>{
        setSettings(s);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
        const svc = new GitHubService(s);
        setGh(svc);
        setShowSettings(false);
        toast("Configura√ß√µes salvas!","success");
      };

      const handleLoad = async (name)=>{
        toast(`Carregando ${name}...`,"info");
        try{
          const d = await gh.get(name);
          setFilename(name);
          if(d.content.includes("<html") && d.content.includes("</html>")){
            try{
              const doc = new DOMParser().parseFromString(d.content,"text/html");
              const st = doc.querySelector("head style");
              setCss(st?.innerHTML.trim()||"");
              st?.remove();
              let jsC = "";
              doc.querySelectorAll("body script").forEach(s=>{ if(s.innerHTML.trim()){ jsC+=s.innerHTML.trim()+"\n"; s.remove(); }});
              setJs(jsC.trim());
              setHtml(doc.body?.innerHTML.trim()||"");
              setFullMode(false);
            }catch(_){ setHtml(d.content); setFullMode(true); }
          }else{ setHtml(d.content); setCss(""); setJs(""); setFullMode(false); }
          lastSaveRef.current = { html:d.content, css:"", js:"" };
          setHasChanges(false);
          setShowFiles(false);
          toast("Carregado!","success");
          if(isMobile) setMobilePane("editor");
        }catch(e){ toast(e.message,"error"); }
      };

      const handleSave = async ()=>{
        if(!gh.ok){ setShowSettings(true); return; }
        if(!filename.endsWith(".html")){ toast("Nome deve terminar em .html","error"); return; }
        setSaving(true);
        try{
          const content = buildFull();
          await gh.save(filename, content);
          saveToHistory();
          lastSaveRef.current = { html, css, js };
          setHasChanges(false);
          localStorage.removeItem(AUTOSAVE_KEY);
          toast("Salvo!","success");
        }catch(e){ toast(e.message,"error"); }
        finally{ setSaving(false); }
      };

      const handleDelete = async (name)=>{
        if(!confirm(`Apagar ${name}?`)) return;
        try{ await gh.del(name); toast("Deletado!","success"); refreshFiles(); }
        catch(e){ toast(e.message,"error"); }
      };

      const handleNew = ()=>{
        setFilename("nova-pagina.html");
        setHtml("<h1>Nova P√°gina</h1>");
        setCss("body{padding:20px;font-family:system-ui}");
        setJs("");
        setFullMode(false);
        setHasChanges(true);
        toast("Novo projeto","info");
        if(isMobile) setMobilePane("editor");
      };

      const applyTemplate = (t)=>{
        setHtml(t.html); setCss(t.css); setJs(t.js);
        setFilename(`${t.id}.html`);
        setFullMode(false);
        setHasChanges(true);
        setShowTemplates(false);
        toast(`Template: ${t.name}`,"success");
        if(isMobile) setMobilePane("editor");
      };

      const restoreHistory = (h)=>{
        setHtml(h.html); setCss(h.css); setJs(h.js);
        setFilename(h.filename); setFullMode(h.fullMode);
        setHasChanges(true);
        setShowHistory(false);
        toast("Hist√≥rico restaurado","success");
      };

      const handleAI = async ()=>{
        if(!settings.geminiApiKey){ toast("Configure a API Key do Gemini","error"); setShowSettings(true); return; }
        if(!aiPrompt.trim()) return;
        setAiLoading(true); setShowAI(false);
        toast("Gemini pensando...","info");
        try{
          const ai = new GoogleGenAI({ apiKey: settings.geminiApiKey });
          const prompt = `Create a single HTML file website: "${aiPrompt}". Return JSON: {html (body only), css, javascript}. Make it modern and responsive.`;
          const r = await ai.models.generateContent({
            model:"gemini-2.0-flash",
            contents:prompt,
            config:{ responseMimeType:"application/json", responseSchema:{ type:Type.OBJECT, properties:{ html:{type:Type.STRING}, css:{type:Type.STRING}, javascript:{type:Type.STRING} }, required:["html","css","javascript"] }}
          });
          const d = JSON.parse(r.text);
          setHtml(d.html||""); setCss(d.css||""); setJs(d.javascript||"");
          setFullMode(false);
          setHasChanges(true);
          toast("Gerado com IA!","success");
          if(isMobile) setMobilePane("editor");
        }catch(e){ toast("Erro IA: "+e.message,"error"); }
        finally{ setAiLoading(false); setAiPrompt(""); }
      };

      const handleSearch = ()=>{
        if(!searchText) return;
        const code = tab==="html"?html:tab==="css"?css:js;
        const idx = code.toLowerCase().indexOf(searchText.toLowerCase());
        if(idx===-1){ toast("N√£o encontrado","warning"); return; }
        toast(`Encontrado na posi√ß√£o ${idx}`,"success");
      };

      const handleReplace = ()=>{
        if(!searchText) return;
        const setter = tab==="html"?setHtml:tab==="css"?setCss:setJs;
        const code = tab==="html"?html:tab==="css"?css:js;
        const newCode = code.split(searchText).join(replaceText);
        setter(newCode);
        toast("Substitu√≠do!","success");
      };

      const openPage = ()=>{
        let name = filename.trim();
        if(!name){ toast("Defina um nome","error"); return; }
        if(name.endsWith(".html")) name = name.slice(0,-5);
        window.open(`/htmls/${name}`,"_blank");
      };

      useEffect(()=>{
        const onKey = (e)=>{
          if((e.ctrlKey||e.metaKey) && e.key==="s"){ e.preventDefault(); handleSave(); }
          if((e.ctrlKey||e.metaKey) && e.key==="f"){ e.preventDefault(); setShowSearch(s=>!s); }
          if((e.ctrlKey||e.metaKey) && e.key==="n"){ e.preventDefault(); handleNew(); }
        };
        window.addEventListener("keydown",onKey);
        return ()=>window.removeEventListener("keydown",onKey);
      },[html,css,js,filename,fullMode]);

      useEffect(()=>{
        const delay = isMobile ? 1000 : 600;
        const t = setTimeout(()=>{
          if(!iframeRef.current) return;
          let doc = fullMode ? html : `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><style>${css}</style></head><body>${html}<script>${js}<\/script></body></html>`;
          if(isMobile && !/eruda\.init/i.test(doc)){
            const erudaScript = `<script src="https://cdn.jsdelivr.net/npm/eruda"><\/script><script>eruda.init();<\/script>`;
            doc = doc.replace(/<\/head>/i, `${erudaScript}</head>`);
          }
          iframeRef.current.srcdoc = doc;
        }, delay);
        return ()=>clearTimeout(t);
      },[html,css,js,fullMode,isMobile]);

      const lineCount = (tab==="html"?html:tab==="css"?css:js).split("\n").length;

      const h = React.createElement;

      return h("div",{id:"app"},
        h("div",{className:"header"},
          h("h1",null,"üöÄ",h("span",{className:"title-text"}," Editor Pro"), hasChanges && h("div",{className:"unsaved-dot",title:"Altera√ß√µes n√£o salvas"})),
          h("div",{className:"header-right"},
            isMobile && h("div",{className:"mobile-toggle"},
              h("button",{className:`btn btn-secondary btn-icon`,onClick:()=>setMobilePane("editor"),title:"Editor"},"üß©"),
              h("button",{className:`btn btn-secondary btn-icon`,onClick:()=>setMobilePane("preview"),title:"Preview"},"üëÅÔ∏è")
            ),
            h("button",{className:"btn btn-secondary btn-icon",onClick:()=>setSettings(s=>({...s,theme:s.theme==="dark"?"light":"dark"})),title:"Tema"},settings.theme==="dark"?"‚òÄÔ∏è":"üåô"),
            h("button",{className:"btn btn-secondary btn-icon",onClick:()=>setShowSettings(true),title:"Config"},"‚öôÔ∏è")
          )
        ),

        h("div",{className:"main-container"},
          h("div",{className:"editor-section"},
            h("div",{className:"controls-panel"},
              h("div",{className:"input-group"},
                h("label",null,"Arquivo"),
                h("input",{type:"text",value:filename,onChange:e=>setFilename(e.target.value),placeholder:"arquivo.html"})
              ),
              h("button",{className:"btn btn-ai",onClick:()=>setShowAI(true),disabled:aiLoading,title:"Gerar com IA"},aiLoading?h("div",{className:"spinner"}):"‚ú®"),
              h("button",{className:"btn btn-secondary btn-icon",onClick:()=>setShowTemplates(true),title:"Templates"},"üìã"),
              h("button",{className:"btn btn-secondary btn-icon",onClick:()=>setShowHistory(true),title:"Hist√≥rico"},"üïê"),
              h("button",{className:"btn btn-secondary btn-icon",onClick:toggleMode,title:fullMode?"Dividir":"Unir"},fullMode?"üìë":"üìÑ"),
              h("button",{className:"btn btn-secondary btn-icon",onClick:()=>setShowSearch(s=>!s),title:"Buscar"},"üîç"),
              h("button",{className:"btn btn-secondary btn-icon",onClick:handleNew,title:"Novo"},"‚ûï"),
              h("button",{className:"btn btn-primary",onClick:handleSave,disabled:saving,title:"Salvar"},saving?"...":"‚òÅÔ∏è"),
              h("button",{className:"btn btn-secondary btn-icon",onClick:handleOpenFiles,title:"Arquivos GitHub"},"üìÇ"),
              h("button",{className:"btn btn-secondary btn-icon",onClick:openPage,title:"Abrir"},"üåê")
            ),

            showSearch && h("div",{className:"search-bar"},
              h("input",{type:"text",value:searchText,onChange:e=>setSearchText(e.target.value),placeholder:"Buscar..."}),
              h("input",{type:"text",value:replaceText,onChange:e=>setReplaceText(e.target.value),placeholder:"Substituir..."}),
              h("button",{className:"btn btn-secondary",onClick:handleSearch},"üîç"),
              h("button",{className:"btn btn-secondary",onClick:handleReplace},"‚ÜîÔ∏è"),
              h("button",{className:"btn btn-secondary btn-icon",onClick:()=>setShowSearch(false)},"‚úï")
            ),

            !fullMode && h("div",{className:"tabs"},
              h("div",{className:`tab ${tab==="html"?"active":""}`,onClick:()=>setTab("html")},"HTML"),
              h("div",{className:`tab ${tab==="css"?"active":""}`,onClick:()=>setTab("css")},"CSS"),
              h("div",{className:`tab ${tab==="js"?"active":""}`,onClick:()=>setTab("js")},"JS")
            ),

            h("div",{className:"editor-container"},
              h("div",{className:"editor-wrapper"},
                settings.showLineNumbers && !isMobile && h("div",{className:"line-numbers"},
                  Array.from({length:lineCount},(_,i)=>h("div",{key:i},i+1))
                ),
                fullMode
                  ? h("textarea",{className:"code-area",value:html,onChange:e=>setHtml(e.target.value),placeholder:"<!-- HTML Completo -->"})
                  : h(React.Fragment,null,
                      tab==="html" && h("textarea",{className:"code-area",value:html,onChange:e=>setHtml(e.target.value),placeholder:"<!-- HTML body -->"}),
                      tab==="css" && h("textarea",{className:"code-area",value:css,onChange:e=>setCss(e.target.value),placeholder:"/* CSS */"}),
                      tab==="js" && h("textarea",{className:"code-area",value:js,onChange:e=>setJs(e.target.value),placeholder:"// JavaScript"})
                    )
              ),
              aiLoading && h("div",{className:"loading-overlay"},h("div",{className:"spinner"}),h("p",null,"Gerando com Gemini..."))
            )
          ),

          h("div",{className:"preview-section"},
            h("iframe",{ref:iframeRef,title:"Preview"})
          )
        ),

        h("div",{className:"toast-container"},
          toasts.map(t=>h("div",{key:t.id,className:`toast toast-${t.type}`},t.msg))
        ),

        isMobile && hasChanges && h("button",{className:"fab",onClick:handleSave,disabled:saving},saving?"...":"üíæ"),

        showFiles && h("div",{className:"modal-overlay",onClick:()=>setShowFiles(false)},
          h("div",{className:"modal-content",onClick:e=>e.stopPropagation()},
            h("h2",{className:"modal-title"},"üìÇ Arquivos GitHub"),
            h("div",{style:{display:"flex",gap:8,marginBottom:12}},
              h("button",{className:"btn btn-secondary",onClick:refreshFiles,disabled:loadingFiles},loadingFiles?"Carregando...":"‚Üª Atualizar")
            ),
            h("div",{className:"file-list-modal"},
              loadingFiles && h("div",{className:"empty-msg"},"Carregando..."),
              !loadingFiles && files.length===0 && h("div",{className:"empty-msg"},"Nenhum arquivo. Configure o GitHub nas ‚öôÔ∏è"),
              !loadingFiles && files.map(f=>h("div",{key:f.name,className:`file-item ${f.name===filename?"active":""}`,onClick:()=>handleLoad(f.name)},
                h("span",{className:"file-name"},f.name),
                h("button",{className:"btn-del",onClick:e=>{e.stopPropagation();handleDelete(f.name);},title:"Apagar"},"üóëÔ∏è")
              ))
            ),
            h("div",{className:"modal-actions"},
              h("button",{className:"btn btn-secondary",onClick:()=>setShowFiles(false)},"Fechar")
            )
          )
        ),

        showAI && h("div",{className:"modal-overlay",onClick:()=>setShowAI(false)},
          h("div",{className:"modal-content",onClick:e=>e.stopPropagation()},
            h("h2",{className:"modal-title"},"‚ú® Criar com IA"),
            h("div",{className:"prompt-chips"},
              PROMPT_SUGGESTIONS.map((p,i)=>h("span",{key:i,className:"prompt-chip",onClick:()=>setAiPrompt(p)},p))
            ),
            h("textarea",{className:"modal-textarea",placeholder:"Descreva a p√°gina...",value:aiPrompt,onChange:e=>setAiPrompt(e.target.value),autoFocus:true}),
            h("div",{className:"modal-actions"},
              h("button",{className:"btn btn-secondary",onClick:()=>setShowAI(false)},"Cancelar"),
              h("button",{className:"btn btn-ai",onClick:handleAI,disabled:!aiPrompt.trim()},"Gerar")
            )
          )
        ),

        showTemplates && h("div",{className:"modal-overlay",onClick:()=>setShowTemplates(false)},
          h("div",{className:"modal-content",onClick:e=>e.stopPropagation()},
            h("h2",{className:"modal-title"},"üìã Templates"),
            h("div",{className:"templates-grid"},
              TEMPLATES.map(t=>h("div",{key:t.id,className:"template-card",onClick:()=>applyTemplate(t)},
                h("div",{className:"template-icon"},t.icon),
                h("div",{className:"template-name"},t.name)
              ))
            ),
            h("div",{className:"modal-actions"},
              h("button",{className:"btn btn-secondary",onClick:()=>setShowTemplates(false)},"Fechar")
            )
          )
        ),

        showHistory && h("div",{className:"modal-overlay",onClick:()=>setShowHistory(false)},
          h("div",{className:"modal-content",onClick:e=>e.stopPropagation()},
            h("h2",{className:"modal-title"},"üïê Hist√≥rico"),
            history.length===0
              ? h("p",{style:{color:"#888",textAlign:"center"}},"Nenhum hist√≥rico ainda")
              : h("div",{className:"history-list"},
                  history.map((item,i)=>h("div",{key:i,className:"history-item",onClick:()=>restoreHistory(item)},
                    h("div",{className:"history-time"},new Date(item.time).toLocaleString()),
                    h("div",{className:"history-preview"},item.filename)
                  ))
                ),
            h("div",{className:"modal-actions"},
              h("button",{className:"btn btn-secondary",onClick:()=>setShowHistory(false)},"Fechar")
            )
          )
        ),

        showSettings && h("div",{className:"modal-overlay"},
          h("div",{className:"modal-content"},
            h("h2",{className:"modal-title"},"‚öôÔ∏è Configura√ß√µes"),
            h("div",{className:"settings-grid"},
              h("div",{className:"input-group"},h("label",null,"GitHub Owner"),h("input",{type:"text",value:settings.githubOwner,onChange:e=>setSettings({...settings,githubOwner:e.target.value}),placeholder:"usuario"})),
              h("div",{className:"input-group"},h("label",null,"Reposit√≥rio"),h("input",{type:"text",value:settings.githubRepo,onChange:e=>setSettings({...settings,githubRepo:e.target.value}),placeholder:"repo"})),
              h("div",{className:"input-group"},h("label",null,"Pasta"),h("input",{type:"text",value:settings.githubPath,onChange:e=>setSettings({...settings,githubPath:e.target.value}),placeholder:"htmls"})),
              h("div",{className:"input-group"},h("label",null,"Branch"),h("input",{type:"text",value:settings.githubBranch,onChange:e=>setSettings({...settings,githubBranch:e.target.value}),placeholder:"main"})),
              h("div",{className:"input-group full"},h("label",null,"GitHub Token"),h("input",{type:"password",value:settings.githubToken,onChange:e=>setSettings({...settings,githubToken:e.target.value}),placeholder:"ghp_..."})),
              h("div",{className:"input-group full"},h("label",null,"Gemini API Key"),h("input",{type:"password",value:settings.geminiApiKey,onChange:e=>setSettings({...settings,geminiApiKey:e.target.value}),placeholder:"AIza..."}))
            ),
            h("div",{className:"toggle-row"},
              h("label",null,"Auto-save local"),
              h("div",{className:`toggle-switch ${settings.autoSave?"active":""}`,onClick:()=>setSettings({...settings,autoSave:!settings.autoSave})})
            ),
            h("div",{className:"toggle-row"},
              h("label",null,"N√∫meros de linha"),
              h("div",{className:`toggle-switch ${settings.showLineNumbers?"active":""}`,onClick:()=>setSettings({...settings,showLineNumbers:!settings.showLineNumbers})})
            ),
            h("div",{className:"modal-actions"},
              h("button",{className:"btn btn-secondary",onClick:()=>setShowSettings(false)},"Fechar"),
              h("button",{className:"btn btn-primary",onClick:()=>handleSaveSettings(settings)},"Salvar")
            )
          )
        )
      );
    }

    createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>

  <script>console.log("P√°gina carregada");</script>
</body>
</html>